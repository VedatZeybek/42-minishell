flowchart TD
    A[User Input] --> B[Input Validation]
    B -->|Not Empty| C[TOKENIZER]
    B -->|Empty| A
    
    C --> C1[Lexical Analysis]
    C1 --> C2[Skip Whitespace]
    C2 --> C3{Token Type?}
    
    C3 -->|Word| C4[Word Token]
    C3 -->|Quote| C5[Quote Handling]
    C3 -->|Operator| C6[Operator Token]
    C3 -->|Special| C7[Special Char Token]
    
    C4 --> C8[Token Linked List]
    C5 -->|Single Quote| C9[Literal String]
    C5 -->|Double Quote| C10[Expandable String]
    C6 -->|Pipe| C11[PIPE Token]
    C6 -->|Redirect| C12[REDIRECT Token]
    C6 -->|Logical| C13[LOGICAL Token]
    C7 -->|Semicolon| C14[SEMICOLON Token]
    
    C9 --> C8
    C10 --> C8
    C11 --> C8
    C12 --> C8
    C13 --> C8
    C14 --> C8
    
    C8 --> D[PARSER]
    
    D --> D1[Syntax Analysis]
    D1 --> D2{Valid Syntax?}
    D2 -->|No| D3[Syntax Error]
    D2 -->|Yes| D4[Command List Creation]
    
    D3 --> END[Error Exit]
    
    D4 --> D5[Create Head Node]
    D5 --> D6{More Tokens?}
    D6 -->|Yes| D7[Parse Command]
    D6 -->|No| D10[Command Linked List]
    
    D7 --> D8[Create Command Node]
    D8 --> D9[Link to Previous Node]
    D9 --> D6
    
    D10 --> E[EXPANDER]
    
    E --> E1[Traverse Command List]
    E1 --> E2[Current Node Expansion]
    E2 --> E3{Variable in Args?}
    E3 -->|Yes| E4[Variable Expansion]
    E3 -->|No| E5[Wildcard Check]
    
    E4 --> E6{Variable Type?}
    E6 -->|Environment| E7[Env Variable Lookup]
    E6 -->|Exit Status| E8[Exit Status Value]
    E6 -->|Process ID| E9[Shell PID]
    
    E7 --> E10[Replace in Args Array]
    E8 --> E10
    E9 --> E10
    
    E10 --> E5[Wildcard Check]
    E5 --> E11{Wildcard in Args?}
    E11 -->|Yes| E12[Glob Pattern Matching]
    E11 -->|No| E13[Next Node Check]
    
    E12 --> E14[Update Args Array]
    E14 --> E13[Next Node Check]
    E13 --> E15{More Nodes?}
    E15 -->|Yes| E16[Move to Next Node]
    E15 -->|No| E17[Expanded Command List]
    E16 --> E2
    
    E17 --> F[EXECUTOR]
    
    F --> F1[Start List Traversal]
    F1 --> F2[Get Current Command Node]
    F2 --> F3{Command Type?}
    
    F3 -->|Builtin| G[BUILTINS]
    F3 -->|External| F4[External Command]
    F3 -->|Pipeline| F5[Pipeline Execution]
    F3 -->|Logical| F6[Logical Execution]
    
    G --> G1{Builtin Type?}
    G1 -->|echo| G2[Echo Implementation]
    G1 -->|cd| G3[Directory Change]
    G1 -->|pwd| G4[Current Directory]
    G1 -->|export| G5[Environment Export]
    G1 -->|unset| G6[Variable Unset]
    G1 -->|env| G7[Environment Display]
    G1 -->|exit| G8[Shell Exit]
    
    G2 --> G9[Builtin Result]
    G3 --> G10{Directory Exists?}
    G4 --> G9
    G5 --> G11[Update Environment]
    G6 --> G12[Remove Variable]
    G7 --> G13[Print Environment]
    G8 --> G14[Exit with Code]
    
    G10 -->|Yes| G15[Change Directory]
    G10 -->|No| G16[Error Message]
    G11 --> G9
    G12 --> G9
    G13 --> G9
    G15 --> G9
    G16 --> G9
    
    F4 --> F7[Setup Redirections]
    F7 --> F8[Fork Process]
    F8 --> F9[Child Process]
    F8 --> F10[Parent Process]
    
    F9 --> F11[execve System Call]
    F11 --> F12{Command Found?}
    F12 -->|Yes| F13[Execute Program]
    F12 -->|No| F14[Command Not Found]
    
    F10 --> F15[wait for Child]
    F13 --> F16[Program Execution]
    F14 --> F17[Error Exit]
    F15 --> F18[Get Exit Status]
    F16 --> F18
    F17 --> F18
    
    F5 --> F19[Create Pipe Array]
    F19 --> F20[Count Pipeline Commands]
    F20 --> F21[Fork for Each Command]
    F21 --> F22[Setup Pipe File Descriptors]
    F22 --> F23[Execute Each Command in List]
    F23 --> F24[Close Pipe FDs]
    F24 --> F25[Wait for All Children]
    F25 --> F18
    
    F6 --> F26{Logical Operator?}
    F26 -->|AND| F27[Check Previous Exit Status]
    F26 -->|OR| F28[Check Previous Exit Status]
    F27 --> F29{Previous Exit is 0?}
    F28 --> F30{Previous Exit not 0?}
    F29 -->|Yes| F31[Execute Current Node]
    F29 -->|No| F32[Skip to Next Logical]
    F30 -->|Yes| F31
    F30 -->|No| F32
    F31 --> F18
    F32 --> F33[Move to Next Node]
    F33 --> F18
    
    G9 --> F34[Update Exit Status]
    F18 --> F34
    F34 --> F35{Next Node in List?}
    F35 -->|Yes| F36[Move to Next Command]
    F35 -->|No| F37[Free Command List]
    F36 --> F2
    F37 --> F38[Display Prompt]
    F38 --> A
    
    G14 --> F39[Free All Lists]
    F39 --> END
    
    style A fill:#e1f5fe
    style C fill:#f3e5f5
    style D fill:#e8f5e8
    style E fill:#fff3e0
    style F fill:#fce4ec
    style G fill:#f1f8e9
    style END fill:#ffebee